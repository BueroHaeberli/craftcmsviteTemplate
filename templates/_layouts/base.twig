{#
Set some variables to be available in all twig contexts.
Prefix with `_` underscore to signal it's been set here.
#}
{% set _doTrack = not craft.app.request.getIsLivePreview() and not craft.app.request.getIsPreview() %}

{# Element edit button #}
{% if currentUser and currentUser.can('accessCp') and not craft.app.request.getIsLivePreview() %}
  {% html at endBody %}
    <div>
      {% set element = craft.app.elements().getElementByUri(craft.app.request.getFullUri() ?: '__home__') %}
      {% if element and element.getIsEditable() %}
        <a href="{{ element.getCpEditUrl() }}"
           target="_blank"
           class="fixed left-0 bottom-0 px-5 py-2 mb-6 ml-6 font-mono uppercase">
          Edit this page
        </a>
      {% endif %}
    </div>
  {% endhtml %}
{% endif %}

{# make sure to capture any flashes so they do not linger #}
{% set flashes = craft.app.session.getAllFlashes() %}
{% if flashes|length %}
  {% html at endBody %}
    <script>
      {% for key, message in flashes if key in ['notice', 'error'] %}
      console.log('{{ key }}:', '{{ message }}');
      {% endfor %}
    </script>
  {% endhtml %}
{% endif %}

{% block response %}
{% endblock %}
